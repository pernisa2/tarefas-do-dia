<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Minhas Tarefas por Dia</title>
  <style>
    :root{
      --bg:#f4f6fb;--card:#ffffff;--ink:#1f2937;--muted:#6b7280;--primary:#2563eb;--primary-ink:#fff;--ok:#16a34a;--warn:#ef4444;--ring:rgba(37,99,235,.25)
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial; color:var(--ink);background:linear-gradient(180deg,#00ff6a, #00f44d 30%, #f4f6fb)}
    .wrap{max-width:920px;margin:40px auto;padding:0 16px}
    .card{background:var(--card);border-radius:18px;box-shadow:0 10px 30px rgba(30,41,59,.08);padding:28px}
    h1{margin:0 0 18px;font-size:clamp(26px, 4vw, 38px);text-align:center;letter-spacing:.3px}
    .subtitle{margin-top:-10px;color:var(--muted);text-align:center}

    .row{display:grid;grid-template-columns: 1fr 160px; gap:10px; margin:22px 0 8px}
    .controls{display:grid;grid-template-columns: 180px 1fr 140px; gap:10px}

    select, input[type="text"], button{border-radius:12px;border:1px solid #e5e7eb; padding:12px 14px;font-size:15px; outline:none; background:#fff}
    select:focus, input[type="text"]:focus{border-color:var(--primary);box-shadow:0 0 0 4px var(--ring)}

    button{cursor:pointer;border:none;color:var(--primary-ink);background:var(--primary);font-weight:600;transition:.15s transform ease, .2s filter}
    button:hover{filter:brightness(.95)}
    button:active{transform:scale(.98)}

    .btn-ghost{background:#fff;color:var(--ink);border:1px solid #e5e7eb}
    .btn-warn{background:var(--warn)}
    .btn-ok{background:var(--ok)}

    .toolbar{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end;margin:6px 0 16px}.toolbar .spacer{flex:1}.file{display:none}

    ul{list-style:none;margin:0;padding:0}
    li{display:grid;grid-template-columns: 36px 1fr auto; gap:10px; align-items:center; padding:10px 12px; border:1px solid #eef0f4; background:#fff;border-radius:12px;margin-bottom:10px}
    .idx{color:var(--muted);text-align:center}
    .task{word-break:break-word}
    .task.done{text-decoration:line-through; color:#94a3b8}
    .actions{display:flex; gap:8px}
    .empty{color:var(--muted);text-align:center;padding:18px}

    .footer{display:flex;justify-content:space-between;align-items:center;margin-top:18px;color:var(--muted);font-size:14px}
    .counter strong{color:var(--ink)}

    @media (max-width:680px){
      .controls{grid-template-columns: 1fr}
      .row{grid-template-columns: 1fr}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Minhas Tarefas do Dia</h1>
      <p class="subtitle">Escolha o dia da semana, adicione tarefas e elas ficam salvas no seu navegador.</p>

      <div class="controls">
        <select id="daySelect" aria-label="Selecionar dia da semana">
          <option value="segunda">Segunda-feira</option>
          <option value="terca">Terça-feira</option>
          <option value="quarta">Quarta-feira</option>
          <option value="quinta">Quinta-feira</option>
          <option value="sexta">Sexta-feira</option>
          <option value="sabado">Sábado</option>
          <option value="domingo">Domingo</option>
        </select>
        <input id="taskInput" type="text" placeholder="Adicionar nova tarefa..." />
        <button id="addBtn" class="btn-ok">Adicionar</button>
      </div>

      <div class="toolbar">
        <span class="spacer"></span>
        <button id="downloadPngBtn" class="btn-ghost" title="Baixar uma imagem PNG do app">Baixar PNG</button>
        <button id="clearDoneBtn" class="btn-ghost">Excluir tarefas concluídas</button>
        <button id="clearAllBtn" class="btn-warn">Excluir todas as tarefas do dia</button>
      </div>

      <h2 style="margin:8px 0 10px">Lista de Tarefas</h2>
      <ul id="taskList" aria-live="polite"></ul>

      <div class="footer">
        <div class="counter">Total de tarefas: <strong id="count">0</strong></div>
        <div class="hint">Dica: clique no texto para marcar como concluída.</div>
      </div>
    </div>
  </div>

  <script>
    // ====== Armazenamento ======
    const STORAGE_KEY = 'tasksByDay_v1';

    function loadAll(){
      try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {} }catch{ return {} }
    }
    function saveAll(data){ localStorage.setItem(STORAGE_KEY, JSON.stringify(data)) }

    // ====== Estado ======
    const daySelect = document.getElementById('daySelect');
    const taskInput = document.getElementById('taskInput');
    const addBtn = document.getElementById('addBtn');
    const clearAllBtn = document.getElementById('clearAllBtn');
    const downloadPngBtn = document.getElementById('downloadPngBtn');
    const clearDoneBtn = document.getElementById('clearDoneBtn');
    const listEl = document.getElementById('taskList');
    const countEl = document.getElementById('count');

    // Seta automaticamente o dia atual ao abrir
    (function initSelectedDay(){
      const map = ['domingo','segunda','terca','quarta','quinta','sexta','sabado'];
      const today = map[new Date().getDay()];
      const idx = Array.from(daySelect.options).findIndex(o => o.value === today);
      if(idx >= 0) daySelect.selectedIndex = idx;
    })();

    function getTasksFor(day){
      const data = loadAll();
      return data[day] || [];
    }
    function setTasksFor(day, tasks){
      const data = loadAll();
      data[day] = tasks;
      saveAll(data);
    }

    // ====== UI ======
    function render(){
      const day = daySelect.value;
      const tasks = getTasksFor(day);
      listEl.innerHTML = '';

      if(tasks.length === 0){
        const empty = document.createElement('div');
        empty.className = 'empty';
        empty.textContent = 'Nenhuma tarefa por enquanto.';
        listEl.appendChild(empty);
      } else {
        tasks.forEach((t, i) => {
          const li = document.createElement('li');

          const idx = document.createElement('div');
          idx.className = 'idx';
          idx.textContent = String(i+1).padStart(2, '0');

          const text = document.createElement('div');
          text.className = 'task' + (t.done ? ' done' : '');
          text.textContent = t.text;
          text.title = 'Clique para alternar concluído';
          text.addEventListener('click', () => toggleDone(i));

          const actions = document.createElement('div');
          actions.className = 'actions';

          const editBtn = document.createElement('button');
          editBtn.className = 'btn-ghost';
          editBtn.textContent = 'Editar';
          editBtn.addEventListener('click', () => editTask(i));

          const delBtn = document.createElement('button');
          delBtn.className = 'btn-warn';
          delBtn.textContent = 'Excluir';
          delBtn.addEventListener('click', () => deleteTask(i));

          actions.append(editBtn, delBtn);
          li.append(idx, text, actions);
          listEl.appendChild(li);
        });
      }

      countEl.textContent = tasks.length;
    }

    // ====== Ações ======
    function addTask(){
      const text = taskInput.value.trim();
      if(!text) return;
      const day = daySelect.value;
      const tasks = getTasksFor(day);
      tasks.push({ text, done:false, createdAt: Date.now() });
      setTasksFor(day, tasks);
      taskInput.value = '';
      render();
      taskInput.focus();
    }

    function toggleDone(index){
      const day = daySelect.value;
      const tasks = getTasksFor(day);
      if(!tasks[index]) return;
      tasks[index].done = !tasks[index].done;
      setTasksFor(day, tasks);
      render();
    }

    function deleteTask(index){
      const day = daySelect.value;
      const tasks = getTasksFor(day);
      tasks.splice(index, 1);
      setTasksFor(day, tasks);
      render();
    }

    function editTask(index){
      const day = daySelect.value;
      const tasks = getTasksFor(day);
      const current = tasks[index];
      const novo = prompt('Editar tarefa:', current.text);
      if(novo === null) return; // cancelou
      const text = novo.trim();
      if(text){ current.text = text; setTasksFor(day, tasks); render(); }
    }

    function clearAll(){
      const day = daySelect.value;
      const tasks = getTasksFor(day);
      if(tasks.length === 0) return;
      if(confirm('Tem certeza que deseja excluir TODAS as tarefas deste dia?')){
        setTasksFor(day, []);
        render();
      }
    }

    function clearDone(){
      const day = daySelect.value;
      const tasks = getTasksFor(day);
      const filtered = tasks.filter(t => !t.done);
      if(filtered.length === tasks.length) return;
      setTasksFor(day, filtered);
      render();
    }

    // ====== Eventos ======
    addBtn.addEventListener('click', addTask);
    taskInput.addEventListener('keydown', e => { if(e.key==='Enter') addTask(); });
    daySelect.addEventListener('change', render);
    clearAllBtn.addEventListener('click', clearAll);
    clearDoneBtn.addEventListener('click', clearDone);
    downloadPngBtn.addEventListener('click', downloadPNG);

    // Inicializa
    render();

    // ====== PNG snapshot ======
    async function downloadPNG(){
      const container = document.querySelector('.card');
      // carrega html2canvas se ainda não estiver carregado
      if(typeof html2canvas === 'undefined'){
        const s = document.createElement('script');
        s.src = 'https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js';
        await new Promise(res=>{ s.onload=res; document.head.appendChild(s); });
      }
      const canvas = await html2canvas(container, {backgroundColor:null, scale:2});
      const a = document.createElement('a');
      a.href = canvas.toDataURL('image/png');
      const date = new Date().toISOString().replace(/[:T]/g,'-').slice(0,16);
      a.download = `minhas-tarefas-${date}.png`;
      a.click();
    }
  </script>
</body>
</html>


